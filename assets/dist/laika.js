!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Laika={},e.Vue)}(this,function(e,t){"use strict";const o=t.reactive({color:"#DE3163",active:!1,percent:0,timestamp:0});let n=null;function a(){function e(e=!1){n&&(window.clearInterval(n),n=null),(o.active||e)&&(o.percent=100,window.setTimeout(()=>{o.active=!1,o.percent=0},150))}return{state:o,start:function(){o.active=!0,o.percent=10,o.timestamp=Date.now(),n&&window.clearInterval(n),n=window.setInterval(()=>{o.active&&o.percent<90&&(o.percent+=Math.max(1,Math.round(.08*(90-o.percent))))},200)},done:e,fail:function(){e(!0)}}}const r=t.defineComponent({setup(e){const o=a();return()=>o.state.active?t.h("div",{class:"laika-progress-bar",style:{top:0,left:0,width:`${o.state.percent}%`,height:"0.2rem",position:"fixed",backgroundColor:`var(--laika-progress-bar, ${o.state.color})`,transition:"width 120ms linear",zIndex:99999}}):void 0}}),i=t.defineComponent({setup(e){const o=y();return()=>{const e=o.page?.content??"";return t.h("div",{innerHTML:e})}}}),l=t.defineComponent({props:{name:{type:String,required:!0}},slots:Object,setup(e,{slots:o}){const n=y();return()=>{if(!n.components||!(e.name in n.components))return null;const a=n.components[e.name]||void 0;if(!a)return null;const r=o.default?.({...a});return t.h("div",{},r??void 0)}}});function u(e){return e?.default??e}const s=t.shallowRef(),c=t.shallowRef(),p=t.shallowRef(null),d=t.ref(void 0),v={payload:()=>{},page:()=>{},visit:async()=>{throw new Error("Laika runtime not ready")},request:async()=>{throw new Error("Laika runtime not ready")}},m=t.defineComponent({name:"Laika",props:{initialPayload:{type:Object,required:!0},initialComponent:{type:Object,required:!1},resolveComponent:{type:Function,required:!0},title:{type:Function,required:!1,default:e=>e}},setup({initialPayload:e,initialComponent:o,resolveComponent:n,title:i}){c.value=e,d.value=void 0;const l=a();return s.value=o?t.markRaw(u(o)):void 0,s.value||Promise.resolve(n(e.component)).then(e=>{s.value=t.markRaw(u(e))}).catch(console.error),v.payload=()=>c.value,v.page=()=>c.value?.page,v.visit=async(e,o)=>{l.start();try{o?.replace?history.replaceState({},"",e):history.pushState({},"",e);const a=await async function(e){const t=await fetch(e,{headers:{Accept:"application/json","X-Laika":"1","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(console.log(t,e),409===t.status){const e=t.headers.get("X-Laika-Location");throw e&&window.location.assign(e),new Error("Laika redirect")}if(!t.ok)throw window.location.assign(e),new Error("Navigation fallback");return await t.json()}(e);await async function(e,o){const a=await n(e.component);s.value=t.markRaw(u(a)),c.value=e;const r=e.page.head?.title;r&&(document.title=(i??(e=>e))(r)),d.value=o?d.value:Date.now()}(a,o?.preserveState),l.done()}catch(e){console.error(e),l.fail()}},v.request=async(e,t)=>({handler:e,data:t}),v.setLayout=e=>{p.value=e},window.addEventListener("popstate",()=>window.location.reload()),()=>{if(!s.value||!c.value)return null;const e=c.value.pageProps??{},o=t.h(s.value,{...e,key:d.value});let n;p.value&&(s.value.layout=p.value,p.value=null);const a=s.value.layout;if(a)if("function"==typeof a)n=a(t.h,o);else{n=(Array.isArray(a)?a:[a]).slice().reverse().reduce((o,n)=>t.h(n,{...e},()=>o),o)}else n=o;return t.h(t.Fragment,null,[t.h(r),n])}}}),f={install(e){Object.defineProperty(e.config.globalProperties,"$laika",{get:()=>v}),Object.defineProperty(e.config.globalProperties,"$payload",{get:()=>c.value})}};function y(){return t.reactive({component:t.computed(()=>s.value),layout:t.computed(()=>p.value),key:t.computed(()=>d.value),payload:t.computed(()=>c.value),version:t.computed(()=>c.value?.version),page:t.computed(()=>c.value?.page),pageProps:t.computed(()=>c.value?.pageProps),sharedProps:t.computed(()=>c.value?.sharedProps),theme:t.computed(()=>c.value?.theme),components:t.computed(()=>c.value?.components),fragments:t.computed(()=>c.value?.fragments),redirect:t.computed(()=>c.value?.redirect),runtime:t.computed(()=>v)})}e.PageComponent=l,e.PageContent=i,e.ProgressBar=r,e.createLaikaApp=async function(e){const t=e.rootId?document.querySelector(e.rootId):document.querySelector(".app");if(!t)throw new Error(`Laika: root element not found (${e.rootId??".app"})`);const o=function(e='[data-laika="payload"]'){const t=document.head.querySelector(e);if(!t?.textContent?.trim())throw new Error("Laika: payload missing/empty");return JSON.parse(t.textContent)}(),n={initialPayload:o,initialComponent:u(await Promise.resolve(e.resolve(o.component))),resolveComponent:e.resolve,...e.title?{title:e.title}:{}};return e.setup({root:t,App:m,props:n,plugin:f,payload:o})},e.default=void 0,e.laikaPlugin=f,e.useLaika=y,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=laika.js.map
