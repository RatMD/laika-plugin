"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");const t=e.reactive({color:"#DE3163",active:!1,percent:0,timestamp:0});let o=null;function a(){function e(e=!1){o&&(window.clearInterval(o),o=null),(t.active||e)&&(t.percent=100,window.setTimeout(()=>{t.active=!1,t.percent=0},150))}return{state:t,start:function(){t.active=!0,t.percent=10,t.timestamp=Date.now(),o&&window.clearInterval(o),o=window.setInterval(()=>{t.active&&t.percent<90&&(t.percent+=Math.max(1,Math.round(.08*(90-t.percent))))},200)},done:e,fail:function(){e(!0)}}}const n=e.defineComponent({setup(t){const o=a();return()=>o.state.active?e.h("div",{class:"laika-progress-bar",style:{top:0,left:0,width:`${o.state.percent}%`,height:"0.2rem",position:"fixed",backgroundColor:`var(--laika-progress-bar, ${o.state.color})`,transition:"width 120ms linear",zIndex:99999}}):void 0}}),r=e.defineComponent({setup(t){const o=f();return()=>{const t=o.page?.content??"";return e.h("div",{innerHTML:t})}}}),i=e.defineComponent({props:{name:{type:String,required:!0}},slots:Object,setup(t,{slots:o}){const a=f();return()=>{if(!a.components||!(t.name in a.components))return null;const n=a.components[t.name]||void 0;if(!n)return null;const r=o.default?.({...n});return e.h("div",{},r??void 0)}}});function l(e){return e?.default??e}const s=e.shallowRef(),u=e.shallowRef(),c=e.shallowRef(null),p=e.ref(void 0),d={payload:()=>{},page:()=>{},visit:async()=>{throw new Error("Laika runtime not ready")},request:async()=>{throw new Error("Laika runtime not ready")}},v=e.defineComponent({name:"Laika",props:{initialPayload:{type:Object,required:!0},initialComponent:{type:Object,required:!1},resolveComponent:{type:Function,required:!0},title:{type:Function,required:!1,default:e=>e}},setup({initialPayload:t,initialComponent:o,resolveComponent:r,title:i}){u.value=t,p.value=void 0;const v=a();return s.value=o?e.markRaw(l(o)):void 0,s.value||Promise.resolve(r(t.component)).then(t=>{s.value=e.markRaw(l(t))}).catch(console.error),d.payload=()=>u.value,d.page=()=>u.value?.page,d.visit=async(t,o)=>{v.start();try{o?.replace?history.replaceState({},"",t):history.pushState({},"",t);const a=await async function(e){const t=await fetch(e,{headers:{Accept:"application/json","X-Laika":"1","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(console.log(t,e),409===t.status){const e=t.headers.get("X-Laika-Location");throw e&&window.location.assign(e),new Error("Laika redirect")}if(!t.ok)throw window.location.assign(e),new Error("Navigation fallback");return await t.json()}(t);await async function(t,o){const a=await r(t.component);s.value=e.markRaw(l(a)),u.value=t;const n=t.page.head?.title;n&&(document.title=(i??(e=>e))(n)),p.value=o?p.value:Date.now()}(a,o?.preserveState),v.done()}catch(e){console.error(e),v.fail()}},d.request=async(e,t)=>({handler:e,data:t}),d.setLayout=e=>{c.value=e},window.addEventListener("popstate",()=>window.location.reload()),()=>{if(!s.value||!u.value)return null;const t=u.value.pageProps??{},o=e.h(s.value,{...t,key:p.value});let a;c.value&&(s.value.layout=c.value,c.value=null);const r=s.value.layout;if(r)if("function"==typeof r)a=r(e.h,o);else{a=(Array.isArray(r)?r:[r]).slice().reverse().reduce((o,a)=>e.h(a,{...t},()=>o),o)}else a=o;return e.h(e.Fragment,null,[e.h(n),a])}}}),m={install(e){Object.defineProperty(e.config.globalProperties,"$laika",{get:()=>d}),Object.defineProperty(e.config.globalProperties,"$payload",{get:()=>u.value})}};function f(){return e.reactive({component:e.computed(()=>s.value),layout:e.computed(()=>c.value),key:e.computed(()=>p.value),payload:e.computed(()=>u.value),version:e.computed(()=>u.value?.version),page:e.computed(()=>u.value?.page),pageProps:e.computed(()=>u.value?.pageProps),sharedProps:e.computed(()=>u.value?.sharedProps),theme:e.computed(()=>u.value?.theme),components:e.computed(()=>u.value?.components),fragments:e.computed(()=>u.value?.fragments),redirect:e.computed(()=>u.value?.redirect),runtime:e.computed(()=>d)})}exports.PageComponent=i,exports.PageContent=r,exports.ProgressBar=n,exports.createLaikaApp=async function(e){const t=e.rootId?document.querySelector(e.rootId):document.querySelector(".app");if(!t)throw new Error(`Laika: root element not found (${e.rootId??".app"})`);const o=function(e='[data-laika="payload"]'){const t=document.head.querySelector(e);if(!t?.textContent?.trim())throw new Error("Laika: payload missing/empty");return JSON.parse(t.textContent)}(),a={initialPayload:o,initialComponent:l(await Promise.resolve(e.resolve(o.component))),resolveComponent:e.resolve,...e.title?{title:e.title}:{}};return e.setup({root:t,App:v,props:a,plugin:m,payload:o})},exports.default=void 0,exports.laikaPlugin=m,exports.useLaika=f;
//# sourceMappingURL=laika.cjs.map
